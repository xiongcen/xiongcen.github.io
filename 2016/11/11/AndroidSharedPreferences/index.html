<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>深入理解SharedPreferences | xiongcen的博客</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="&amp;#x6458;&amp;#x8981;&amp;#x5173;&amp;#x4E8E;SharedPreferences&amp;#x9700;&amp;#x8981;&amp;#x77E5;&amp;#x9053;&amp;#x7684;&amp;#x95EE;&amp;#x9898;&amp;#xFF1A;

SharedPreferences&amp;#x7684;&amp;#x7EBF;&amp;#x7A0B;&amp;#x5B89;&amp;#x5168;&amp;#x5417;&amp;#xFF1F;
&amp;#x6BCF;&amp;#x">
<meta property="og:type" content="article">
<meta property="og:title" content="深入理解SharedPreferences">
<meta property="og:url" content="http://yoursite.com/2016/11/11/AndroidSharedPreferences/index.html">
<meta property="og:site_name" content="xiongcen的博客">
<meta property="og:description" content="&amp;#x6458;&amp;#x8981;&amp;#x5173;&amp;#x4E8E;SharedPreferences&amp;#x9700;&amp;#x8981;&amp;#x77E5;&amp;#x9053;&amp;#x7684;&amp;#x95EE;&amp;#x9898;&amp;#xFF1A;

SharedPreferences&amp;#x7684;&amp;#x7EBF;&amp;#x7A0B;&amp;#x5B89;&amp;#x5168;&amp;#x5417;&amp;#xFF1F;
&amp;#x6BCF;&amp;#x">
<meta property="og:image" content="http://yoursite.com/2016/11/11/AndroidSharedPreferences/sharedpreferences_1.gif">
<meta property="og:image" content="http://yoursite.com/2016/11/11/AndroidSharedPreferences/sharedpreferences_2.png">
<meta property="og:image" content="http://yoursite.com/2016/11/11/AndroidSharedPreferences/sharedpreferences_3.png">
<meta property="og:image" content="http://yoursite.com/2016/11/11/AndroidSharedPreferences/sharedpreferences_4.png">
<meta property="og:image" content="http://yoursite.com/2016/11/11/AndroidSharedPreferences/sharedpreferences_5.png">
<meta property="og:image" content="http://yoursite.com/2016/11/11/AndroidSharedPreferences/sharedpreferences_6.png">
<meta property="og:image" content="http://yoursite.com/2016/11/11/AndroidSharedPreferences/sharedpreferences_7.png">
<meta property="og:image" content="http://yoursite.com/2016/11/11/AndroidSharedPreferences/sharedpreferences_8.png">
<meta property="og:image" content="http://yoursite.com/2016/11/11/AndroidSharedPreferences/sharedpreferences_9.png">
<meta property="og:image" content="http://yoursite.com/2016/11/11/AndroidSharedPreferences/sharedpreferences_10.png">
<meta property="og:image" content="http://yoursite.com/2016/11/11/AndroidSharedPreferences/sharedpreferences_11.png">
<meta property="og:image" content="http://yoursite.com/2016/11/11/AndroidSharedPreferences/sharedpreferences_12.png">
<meta property="og:image" content="http://yoursite.com/2016/11/11/AndroidSharedPreferences/sharedpreferences_13.png">
<meta property="og:image" content="http://yoursite.com/2016/11/11/AndroidSharedPreferences/sharedpreferences_14.png">
<meta property="og:image" content="http://yoursite.com/2016/11/11/AndroidSharedPreferences/sharedpreferences_15.png">
<meta property="og:image" content="http://yoursite.com/2016/11/11/AndroidSharedPreferences/sharedpreferences_16.png">
<meta property="og:image" content="http://yoursite.com/2016/11/11/AndroidSharedPreferences/sharedpreferences_17.png">
<meta property="og:image" content="http://yoursite.com/2016/11/11/AndroidSharedPreferences/sharedpreferences_18.png">
<meta property="og:updated_time" content="2021-04-23T15:12:39.386Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="深入理解SharedPreferences">
<meta name="twitter:description" content="&amp;#x6458;&amp;#x8981;&amp;#x5173;&amp;#x4E8E;SharedPreferences&amp;#x9700;&amp;#x8981;&amp;#x77E5;&amp;#x9053;&amp;#x7684;&amp;#x95EE;&amp;#x9898;&amp;#xFF1A;

SharedPreferences&amp;#x7684;&amp;#x7EBF;&amp;#x7A0B;&amp;#x5B89;&amp;#x5168;&amp;#x5417;&amp;#xFF1F;
&amp;#x6BCF;&amp;#x">
<meta name="twitter:image" content="http://yoursite.com/2016/11/11/AndroidSharedPreferences/sharedpreferences_1.gif">
  
    <link rel="alternate" href="/atom.xml" title="xiongcen的博客" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">xiongcen的博客</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-AndroidSharedPreferences" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/11/11/AndroidSharedPreferences/" class="article-date">
  <time datetime="2016-11-11T10:14:18.000Z" itemprop="datePublished">2016-11-11</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Android/">Android</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      深入理解SharedPreferences
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h5 id="&#x6458;&#x8981;"><a href="#&#x6458;&#x8981;" class="headerlink" title="&#x6458;&#x8981;"></a>&#x6458;&#x8981;</h5><p>&#x5173;&#x4E8E;SharedPreferences&#x9700;&#x8981;&#x77E5;&#x9053;&#x7684;&#x95EE;&#x9898;&#xFF1A;</p>
<ol>
<li>SharedPreferences&#x7684;&#x7EBF;&#x7A0B;&#x5B89;&#x5168;&#x5417;&#xFF1F;</li>
<li>&#x6BCF;&#x6B21;&#x8C03;&#x7528;getSharedPreferences&#x65F6;&#x90FD;&#x4F1A;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;SharedPreferences&#x5BF9;&#x8C61;&#x5417;&#xFF1F;&#x8FD9;&#x4E2A;&#x5BF9;&#x8C61;&#x5177;&#x4F53;&#x662F;&#x54EA;&#x4E2A;&#x7C7B;&#x5BF9;&#x8C61;&#xFF1F; </li>
<li>&#x5728;UI&#x7EBF;&#x7A0B;&#x4E2D;&#x8C03;&#x7528;getXXX&#x6709;&#x53EF;&#x80FD;&#x5BFC;&#x81F4;ANR&#x5417;&#xFF1F; </li>
<li>&#x4E3A;&#x4EC0;&#x4E48;SharedPreferences&#x53EA;&#x9002;&#x5408;&#x7528;&#x6765;&#x5B58;&#x653E;&#x5C11;&#x91CF;&#x6570;&#x636E;&#xFF0C;&#x4E3A;&#x4EC0;&#x4E48;&#x4E0D;&#x80FD;&#x628A;SharedPreferences&#x5BF9;&#x5E94;&#x7684;xml&#x6587;&#x4EF6;&#x5F53;&#x6210;&#x666E;&#x901A;&#x6587;&#x4EF6;&#x4E00;&#x6837;&#x5B58;&#x653E;&#x5927;&#x91CF;&#x6570;&#x636E;&#xFF1F; </li>
<li>commit&#x548C;apply&#x6709;&#x4EC0;&#x4E48;&#x533A;&#x522B;&#xFF1F; </li>
<li>SharedPreferences&#x6BCF;&#x6B21;&#x5199;&#x5165;&#x65F6;&#x662F;&#x589E;&#x91CF;&#x5199;&#x5165;&#x5417;&#xFF1F;</li>
</ol>
<a id="more"></a>
<p>&#x90A3;&#x4E48;&#x4EE3;&#x7801;&#x662F;&#x5982;&#x4F55;&#x4FDD;&#x8BC1;SharedPreferences&#x7684;&#x7EBF;&#x7A0B;&#x5B89;&#x5168;&#xFF0C;&#x6211;&#x4EEC;&#x5148;&#x8981;&#x4E86;&#x89E3;Context&#x3002;</p>
<p>Context&#xFF0C;&#x4E2D;&#x6587;&#x76F4;&#x8BD1;&#x4E3A;&#x201C;&#x4E0A;&#x4E0B;&#x6587;&#x201D;</p>
<ol>
<li>&#x5B83;&#x63CF;&#x8FF0;&#x7684;&#x662F;&#x4E00;&#x4E2A;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x73AF;&#x5883;&#x7684;&#x4FE1;&#x606F;&#xFF0C;&#x5373;&#x4E0A;&#x4E0B;&#x6587;&#x3002;</li>
<li>&#x8BE5;&#x7C7B;&#x662F;&#x4E00;&#x4E2A;&#x62BD;&#x8C61;(abstract class)&#x7C7B;&#xFF0C;Android&#x63D0;&#x4F9B;&#x4E86;&#x8BE5;&#x62BD;&#x8C61;&#x7C7B;&#x7684;&#x5177;&#x4F53;&#x5B9E;&#x73B0;&#x7C7B;(&#x540E;&#x9762;&#x6211;&#x4EEC;&#x4F1A;&#x8BB2;&#x5230;&#x662F;ContextIml&#x7C7B;)&#x3002;</li>
<li>&#x901A;&#x8FC7;&#x5B83;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x83B7;&#x53D6;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7684;&#x8D44;&#x6E90;&#x548C;&#x7C7B;&#xFF0C;&#x4E5F;&#x5305;&#x62EC;&#x4E00;&#x4E9B;&#x5E94;&#x7528;&#x7EA7;&#x522B;&#x64CD;&#x4F5C;&#xFF0C;&#x4F8B;&#x5982;&#xFF1A;&#x542F;&#x52A8;&#x4E00;&#x4E2A;Activity&#xFF0C;&#x53D1;&#x9001;&#x5E7F;&#x64AD;&#xFF0C;&#x63A5;&#x53D7;Intent&#x4FE1;&#x606F;&#x7B49;&#x3002;</li>
</ol>
<h3 id="Context&#x76F8;&#x5173;&#x7C7B;&#x7684;&#x7EE7;&#x627F;&#x5173;&#x7CFB;"><a href="#Context&#x76F8;&#x5173;&#x7C7B;&#x7684;&#x7EE7;&#x627F;&#x5173;&#x7CFB;" class="headerlink" title="Context&#x76F8;&#x5173;&#x7C7B;&#x7684;&#x7EE7;&#x627F;&#x5173;&#x7CFB;"></a>Context&#x76F8;&#x5173;&#x7C7B;&#x7684;&#x7EE7;&#x627F;&#x5173;&#x7CFB;</h3><p><img src="/2016/11/11/AndroidSharedPreferences/sharedpreferences_1.gif" alt=""></p>
<p>Context&#x7C7B;  </p>
<p>&#x8DEF;&#x5F84;&#xFF1A;/frameworks/base/core/java/android/content/Context.java</p>
<p>&#x8BF4;&#x660E;&#xFF1A;&#x62BD;&#x8C61;&#x7C7B;&#xFF0C;&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x7EC4;&#x901A;&#x7528;&#x7684;API&#x3002;</p>
<p>ContextIml.java&#x7C7B;  </p>
<p>&#x8DEF;&#x5F84; &#xFF1A;/frameworks/base/core/java/android/app/ContextImpl.java</p>
<p>&#x8BF4;&#x660E;&#xFF1A;&#x8BE5;Context&#x7C7B;&#x7684;&#x5B9E;&#x73B0;&#x7C7B;&#x4E3A;ContextIml&#xFF0C;&#x8BE5;&#x7C7B;&#x5B9E;&#x73B0;&#x4E86;Context&#x7C7B;&#x7684;&#x529F;&#x80FD;&#x3002;&#x8BF7;&#x6CE8;&#x610F;&#xFF0C;&#x8BE5;&#x51FD;&#x6570;&#x7684;&#x5927;&#x90E8;&#x5206;&#x529F;&#x80FD;&#x90FD;&#x662F;&#x76F4;&#x63A5;&#x8C03;&#x7528;&#x5176;&#x5C5E;&#x6027;mPackageInfo&#x53BB;&#x5B8C;&#x6210;&#xFF0C;&#x8FD9;&#x70B9;&#x6211;&#x4EEC;&#x540E;&#x9762;&#x4F1A;&#x8BB2;&#x5230;&#x3002;   </p>
<p>ContextWrapper&#x7C7B; </p>
<p>&#x8DEF;&#x5F84; &#xFF1A;/frameworks/base/core/java/android/content/ContextWrapper.java</p>
<p>&#x8BF4;&#x660E;&#xFF1A; &#x6B63;&#x5982;&#x5176;&#x540D;&#x79F0;&#x4E00;&#x6837;&#xFF0C;&#x8BE5;&#x7C7B;&#x53EA;&#x662F;&#x5BF9;Context&#x7C7B;&#x7684;&#x4E00;&#x79CD;&#x5305;&#x88C5;&#xFF0C;&#x8BE5;&#x7C7B;&#x7684;&#x6784;&#x9020;&#x51FD;&#x6570;&#x5305;&#x542B;&#x4E86;&#x4E00;&#x4E2A;&#x771F;&#x6B63;&#x7684;Context&#x5F15;&#x7528;&#xFF0C;&#x5373;ContextIml&#x5BF9;&#x8C61;&#x3002; </p>
<p><img src="/2016/11/11/AndroidSharedPreferences/sharedpreferences_2.png" alt=""></p>
<p>ContextThemeWrapper&#x7C7B; </p>
<p>&#x8DEF;&#x5F84;&#xFF1A;/frameworks/base/core/java/android/view/ContextThemeWrapper.java</p>
<p>&#x8BF4;&#x660E;&#xFF1A;&#x8BE5;&#x7C7B;&#x5185;&#x90E8;&#x5305;&#x542B;&#x4E86;&#x4E3B;&#x9898;(Theme)&#x76F8;&#x5173;&#x7684;&#x63A5;&#x53E3;&#xFF0C;&#x5373;android:theme&#x5C5E;&#x6027;&#x6307;&#x5B9A;&#x7684;&#x3002;&#x53EA;&#x6709;Activity&#x9700;&#x8981;&#x4E3B;&#x9898;&#xFF0C;Service&#x4E0D;&#x9700;&#x8981;&#x4E3B;&#x9898;&#xFF0C;&#x6240;&#x4EE5;Service&#x76F4;&#x63A5;&#x7EE7;&#x627F;&#x4E8E;ContextWrapper&#x7C7B;&#x3002;</p>
<h3 id="&#x4EC0;&#x4E48;&#x65F6;&#x5019;&#x521B;&#x5EFA;Context&#x5B9E;&#x4F8B;"><a href="#&#x4EC0;&#x4E48;&#x65F6;&#x5019;&#x521B;&#x5EFA;Context&#x5B9E;&#x4F8B;" class="headerlink" title="&#x4EC0;&#x4E48;&#x65F6;&#x5019;&#x521B;&#x5EFA;Context&#x5B9E;&#x4F8B;"></a>&#x4EC0;&#x4E48;&#x65F6;&#x5019;&#x521B;&#x5EFA;Context&#x5B9E;&#x4F8B;</h3><p>&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x521B;&#x5EFA;Context&#x5B9E;&#x4F8B;&#x6709;&#x5982;&#x4E0B;&#x51E0;&#x79CD;&#x60C5;&#x51B5;&#xFF1A;</p>
<ol>
<li>&#x521B;&#x5EFA;Application&#x5BF9;&#x8C61;&#x65F6;&#xFF0C;&#x800C;&#x4E14;&#x6574;&#x4E2A;App&#x5171;&#x4E00;&#x4E2A;Application&#x5BF9;&#x8C61;</li>
<li>&#x521B;&#x5EFA;Service&#x5BF9;&#x8C61;&#x65F6;</li>
<li>&#x521B;&#x5EFA;Activity&#x5BF9;&#x8C61;&#x65F6;</li>
</ol>
<p>&#x56E0;&#x6B64;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;App&#x5171;&#x6709;&#x7684;Context&#x6570;&#x76EE;&#x516C;&#x5F0F;&#x4E3A;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&#x603B;Context&#x5B9E;&#x4F8B;&#x4E2A;&#x6570; = Service&#x4E2A;&#x6570; + Activity&#x4E2A;&#x6570; + 1&#xFF08;Application&#x5BF9;&#x5E94;&#x7684;Context&#x5B9E;&#x4F8B;&#xFF09;</div></pre></td></tr></table></figure>
<h4 id="&#x521B;&#x5EFA;Application&#x5BF9;&#x8C61;&#x7684;&#x65F6;&#x673A;"><a href="#&#x521B;&#x5EFA;Application&#x5BF9;&#x8C61;&#x7684;&#x65F6;&#x673A;" class="headerlink" title="&#x521B;&#x5EFA;Application&#x5BF9;&#x8C61;&#x7684;&#x65F6;&#x673A;"></a>&#x521B;&#x5EFA;Application&#x5BF9;&#x8C61;&#x7684;&#x65F6;&#x673A;</h4><p>&#x6BCF;&#x4E2A;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x5728;&#x7B2C;&#x4E00;&#x6B21;&#x542F;&#x52A8;&#x65F6;&#xFF0C;&#x90FD;&#x4F1A;&#x9996;&#x5148;&#x521B;&#x5EFA;Application&#x5BF9;&#x8C61;&#x3002;&#x5982;&#x679C;&#x5BF9;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x542F;&#x52A8;&#x4E00;&#x4E2A;Activity(startActivity)&#x6D41;&#x7A0B;&#x6BD4;&#x8F83;<br>&#x6E05;&#x695A;&#x7684;&#x8BDD;&#xFF0C;&#x521B;&#x5EFA;Application&#x7684;&#x65F6;&#x673A;&#x5728;&#x521B;&#x5EFA;handleBindApplication()&#x65B9;&#x6CD5;&#x4E2D;&#xFF0C;&#x8BE5;&#x51FD;&#x6570;&#x4F4D;&#x4E8E; ActivityThread.java&#x7C7B;&#x4E2D; &#xFF0C;&#x5982;&#x4E0B;&#xFF1A;</p>
<p><img src="/2016/11/11/AndroidSharedPreferences/sharedpreferences_3.png" alt=""></p>
<h4 id="&#x521B;&#x5EFA;Activity&#x5BF9;&#x8C61;&#x7684;&#x65F6;&#x673A;"><a href="#&#x521B;&#x5EFA;Activity&#x5BF9;&#x8C61;&#x7684;&#x65F6;&#x673A;" class="headerlink" title="&#x521B;&#x5EFA;Activity&#x5BF9;&#x8C61;&#x7684;&#x65F6;&#x673A;"></a>&#x521B;&#x5EFA;Activity&#x5BF9;&#x8C61;&#x7684;&#x65F6;&#x673A;</h4><p>&#x901A;&#x8FC7;startActivity()&#x6216;startActivityForResult()&#x8BF7;&#x6C42;&#x542F;&#x52A8;&#x4E00;&#x4E2A;Activity&#x65F6;&#xFF0C;&#x5982;&#x679C;&#x7CFB;&#x7EDF;&#x68C0;&#x6D4B;&#x9700;&#x8981;&#x65B0;&#x5EFA;&#x4E00;&#x4E2A;Activity&#x5BF9;&#x8C61;&#x65F6;&#xFF0C;&#x5C31;&#x4F1A;&#x56DE;&#x8C03;handleLaunchActivity()&#x65B9;&#x6CD5;&#xFF0C;&#x8BE5;&#x65B9;&#x6CD5;&#x7EE7;&#x800C;&#x8C03;&#x7528;performLaunchActivity()&#x65B9;&#x6CD5;&#xFF0C;&#x53BB;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;Activity&#x5B9E;&#x4F8B;&#xFF0C;&#x5E76;&#x4E14;&#x56DE;&#x8C03;onCreate()&#xFF0C;onStart()&#x65B9;&#x6CD5;&#x7B49;&#xFF0C; &#x51FD;&#x6570;&#x90FD;&#x4F4D;&#x4E8E; ActivityThread.java&#x7C7B; &#xFF0C;&#x5982;&#x4E0B;&#xFF1A;</p>
<p><img src="/2016/11/11/AndroidSharedPreferences/sharedpreferences_4.png" alt=""></p>
<h4 id="&#x521B;&#x5EFA;Service&#x5BF9;&#x8C61;&#x7684;&#x65F6;&#x673A;"><a href="#&#x521B;&#x5EFA;Service&#x5BF9;&#x8C61;&#x7684;&#x65F6;&#x673A;" class="headerlink" title="&#x521B;&#x5EFA;Service&#x5BF9;&#x8C61;&#x7684;&#x65F6;&#x673A;"></a>&#x521B;&#x5EFA;Service&#x5BF9;&#x8C61;&#x7684;&#x65F6;&#x673A;</h4><p>&#x901A;&#x8FC7;startService&#x6216;&#x8005;bindService&#x65F6;&#xFF0C;&#x5982;&#x679C;&#x7CFB;&#x7EDF;&#x68C0;&#x6D4B;&#x5230;&#x9700;&#x8981;&#x65B0;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;Service&#x5B9E;&#x4F8B;&#xFF0C;&#x5C31;&#x4F1A;&#x56DE;&#x8C03;handleCreateService()&#x65B9;&#x6CD5;&#xFF0C;&#x5B8C;&#x6210;&#x76F8;&#x5173;&#x6570;&#x636E;&#x64CD;&#x4F5C;&#x3002;handleCreateService()&#x51FD;&#x6570;&#x4F4D;&#x4E8E; ActivityThread.java&#x7C7B;&#xFF0C;&#x5982;&#x4E0B;&#xFF1A;</p>
<p><img src="/2016/11/11/AndroidSharedPreferences/sharedpreferences_5.png" alt=""></p>
<p>&#x53E6;&#x5916;&#xFF0C;&#x9700;&#x8981;&#x5F3A;&#x8C03;&#x4E00;&#x70B9;&#x7684;&#x662F;&#xFF0C;&#x901A;&#x8FC7;&#x5BF9;ContextImp&#x7684;&#x5206;&#x6790;&#x53EF;&#x77E5;&#xFF0C;&#x5176;&#x65B9;&#x6CD5;&#x7684;&#x5927;&#x591A;&#x6570;&#x64CD;&#x4F5C;&#x90FD;&#x662F;&#x76F4;&#x63A5;&#x8C03;&#x7528;&#x5176;&#x5C5E;&#x6027;mPackageInfo(&#x8BE5;&#x5C5E;&#x6027;&#x7C7B;&#x578B;&#x4E3A;PackageInfo)&#x7684;&#x76F8;&#x5173;&#x65B9;&#x6CD5;&#x800C;&#x6765;&#x3002;&#x8FD9;&#x8BF4;&#x660E;ContextImp&#x662F;&#x4E00;&#x79CD;&#x8F7B;&#x91CF;&#x7EA7;&#x7C7B;&#xFF0C;&#x800C;PackageInfo&#x624D;&#x662F;&#x771F;&#x6B63;&#x91CD;&#x91CF;&#x7EA7;&#x7684;&#x7C7B;&#x3002;&#x800C;&#x4E00;&#x4E2A;App&#x91CC;&#x7684;&#x6240;&#x6709;ContextIml&#x5B9E;&#x4F8B;&#xFF0C;&#x90FD;&#x5BF9;&#x5E94;&#x540C;&#x4E00;&#x4E2A;packageInfo&#x5BF9;&#x8C61;&#x3002;</p>
<h3 id="SharedPreferences&#x76F8;&#x5173;"><a href="#SharedPreferences&#x76F8;&#x5173;" class="headerlink" title="SharedPreferences&#x76F8;&#x5173;"></a>SharedPreferences&#x76F8;&#x5173;</h3><h4 id="Context&#x83B7;&#x53D6;SharedPreferences&#x7C7B;&#x7684;&#x4F7F;&#x7528;&#x65B9;&#x6CD5;&#x6700;&#x7EC8;&#x8C03;&#x7528;&#x5982;&#x4E0B;&#xFF1A;"><a href="#Context&#x83B7;&#x53D6;SharedPreferences&#x7C7B;&#x7684;&#x4F7F;&#x7528;&#x65B9;&#x6CD5;&#x6700;&#x7EC8;&#x8C03;&#x7528;&#x5982;&#x4E0B;&#xFF1A;" class="headerlink" title="Context&#x83B7;&#x53D6;SharedPreferences&#x7C7B;&#x7684;&#x4F7F;&#x7528;&#x65B9;&#x6CD5;&#x6700;&#x7EC8;&#x8C03;&#x7528;&#x5982;&#x4E0B;&#xFF1A;"></a>Context&#x83B7;&#x53D6;SharedPreferences&#x7C7B;&#x7684;&#x4F7F;&#x7528;&#x65B9;&#x6CD5;&#x6700;&#x7EC8;&#x8C03;&#x7528;&#x5982;&#x4E0B;&#xFF1A;</h4><p><img src="/2016/11/11/AndroidSharedPreferences/sharedpreferences_6.png" alt=""></p>
<p>&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x8FD9;&#x91CC;&#x4F7F;&#x7528;&#x5230;&#x4E86;&#x5355;&#x4F8B;&#x6A21;&#x5F0F;&#xFF0C;sSharedPrefsCache&#x662F;&#x4E00;&#x4E2A;ArrayMap&#xFF0C;packagePrefs&#x4E5F;&#x662F;&#x4E00;&#x4E2A;ArrayMap&#xFF0C;&#x5B83;&#x4EEC;&#x7684;&#x5173;&#x7CFB;&#x662F;&#x8FD9;&#x6837;&#x7684;&#xFF1A; </p>
<p>packagePrefs&#x5B58;&#x653E;&#x6587;&#x4EF6;name&#x4E0E;SharedPreferencesImpl&#x952E;&#x503C;&#x5BF9;&#xFF0C;sSharedPrefsCache&#x5B58;&#x653E;&#x5305;&#x540D;&#x4E0E;ArrayMap&#x952E;&#x503C;&#x5BF9;&#x3002;&#x6CE8;&#x610F;sSharedPrefsCache&#x662F;static&#x53D8;&#x91CF;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x4E00;&#x4E2A;&#x7C7B;&#x53EA;&#x6709;&#x4E00;&#x4E2A;&#x5B9E;&#x4F8B;&#xFF0C;<font color="Red">&#x56E0;&#x6B64;&#x6BCF;&#x6B21;getSharedPreferences&#x5176;&#x5B9E;&#x62FF;&#x5230;&#x7684;&#x90FD;&#x662F;&#x540C;&#x4E00;&#x4E2A;SharedPreferences&#x5BF9;&#x8C61;&#x3002;</font></p>
<p><img src="/2016/11/11/AndroidSharedPreferences/sharedpreferences_7.png" alt=""></p>
<p>&#x5BF9;&#x4E8E;&#x4E00;&#x4E2A;SharedPreferences&#x6587;&#x4EF6;name&#xFF0C;&#x7B2C;&#x4E00;&#x6B21;&#x8C03;&#x7528;getSharedPreferences&#x65F6;&#x4F1A;&#x53BB;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;SharedPreferencesImpl&#x5BF9;&#x8C61;&#xFF0C;SharedPreferencesImpl&#x7684;&#x6784;&#x9020;&#x65B9;&#x6CD5;&#x6700;&#x7EC8;&#x8C03;&#x7528;startLoadFromDisk()&#x65B9;&#x6CD5;&#x3002;&#x5B83;&#x4F1A;&#x5F00;&#x542F;&#x4E00;&#x4E2A;&#x5B50;&#x7EBF;&#x7A0B;&#xFF0C;&#x7136;&#x540E;&#x53BB;&#x628A;&#x6307;&#x5B9A;&#x7684;SharedPreferences&#x6587;&#x4EF6;&#x4E2D;&#x7684;&#x952E;&#x503C;&#x5BF9;&#x5168;&#x90E8;&#x8BFB;&#x53D6;&#x51FA;&#x6765;&#xFF0C;&#x5B58;&#x653E;&#x5728;&#x4E00;&#x4E2A;Map&#x4E2D;&#x3002;</p>
<h4 id="SharedPreferencesImpl&#x7684;getXXX-&#x65B9;&#x6CD5;"><a href="#SharedPreferencesImpl&#x7684;getXXX-&#x65B9;&#x6CD5;" class="headerlink" title="SharedPreferencesImpl&#x7684;getXXX()&#x65B9;&#x6CD5;"></a>SharedPreferencesImpl&#x7684;getXXX()&#x65B9;&#x6CD5;</h4><p>&#x5982;&#x679C;&#x6211;&#x4EEC;&#x5728;UI&#x7EBF;&#x7A0B;&#x8FD9;&#x6837;&#x5199;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">SharedPreferences sp = getSharedPreferences(&quot;test&quot;, Context.MODE_PRIVATE);</div><div class="line">String name = sp.getString(&quot;name&quot;, null);</div></pre></td></tr></table></figure>
<p>&#x770B;&#x770B;getString()&#x7684;&#x6E90;&#x7801;&#xFF1A;</p>
<p><img src="/2016/11/11/AndroidSharedPreferences/sharedpreferences_8.png" alt=""><br><img src="/2016/11/11/AndroidSharedPreferences/sharedpreferences_9.png" alt=""></p>
<p>&#x6CE8;&#x610F;&#x4E4B;&#x524D;&#x8BFB;&#x53D6;&#x6307;&#x5B9A;&#x7684;SharedPreferences&#x6587;&#x4EF6;&#x4E2D;&#x952E;&#x503C;&#x5BF9;&#x4EE3;&#x7801;&#xFF0C;&#x6211;&#x4EEC;&#x770B;&#x5230;&#x6709;&#x4E00;&#x4E2A;&#x53D8;&#x91CF;mLoaded&#xFF0C;&#x5B83;&#x7528;&#x6765;&#x6807;&#x8BC6;&#x6587;&#x4EF6;&#x662F;&#x5426;&#x8BFB;&#x53D6;&#x5B8C;&#x6210;&#x3002;&#x5982;&#x679C;mLoaded&#x4E3A;false&#xFF0C;&#x90A3;&#x4E48;awaitLoadedLocked()&#x4F1A;&#x4E00;&#x76F4;&#x963B;&#x585E;&#xFF0C;&#x6240;&#x4EE5;getString()&#x6709;&#x53EF;&#x80FD;&#x8FDF;&#x8FDF;&#x65E0;&#x6CD5;&#x8FD4;&#x56DE;&#xFF0C;&#x88AB;&#x963B;&#x585E;&#x4F4F;&#x3002;&#x4E00;&#x65E6;loadFromDiskLocked()&#x65B9;&#x6CD5;&#x8C03;&#x7528;&#x5FEB;&#x7ED3;&#x675F;&#xFF0C;mLoaded&#x65B9;&#x6CD5;&#x88AB;&#x7F6E;&#x4E3A;true&#xFF0C;&#x5E76;&#x4E14;notifyAll()&#xFF0C;getString()&#x7684;&#x963B;&#x585E;&#x5C31;&#x4F1A;&#x88AB;&#x5524;&#x9192;&#x3002;&#x6240;&#x4EE5;&#xFF0C;<font color="Red">&#x5728;UI&#x7EBF;&#x7A0B;&#x4E2D;&#x8C03;&#x7528;getXXX&#x53EF;&#x80FD;&#x4F1A;&#x5BFC;&#x81F4;ANR</font>&#xFF0C;&#x8981;&#x6839;&#x636E;&#x5177;&#x4F53;&#x60C5;&#x51B5;&#x8003;&#x8651;&#x662F;&#x5426;&#x9700;&#x8981;&#x628A;SharedPreferences&#x7684;&#x8BFB;&#x5199;&#x653E;&#x5728;&#x5B50;&#x7EBF;&#x7A0B;&#x4E2D;&#x3002;SharedPreferences&#x53EA;&#x80FD;&#x7528;&#x6765;&#x5B58;&#x653E;&#x5C11;&#x91CF;&#x6570;&#x636E;&#xFF0C;&#x5982;&#x679C;&#x4E00;&#x4E2A;SharedPreferences&#x5BF9;&#x5E94;&#x7684;xml&#x6587;&#x4EF6;&#x5F88;&#x5927;&#x7684;&#x8BDD;&#xFF0C;&#x5728;&#x521D;&#x59CB;&#x5316;&#x65F6;&#x4F1A;&#x628A;&#x8FD9;&#x4E2A;&#x6587;&#x4EF6;&#x7684;&#x6240;&#x6709;&#x6570;&#x636E;&#x90FD;&#x52A0;&#x8F7D;&#x5230;&#x5185;&#x5B58;&#x4E2D;&#xFF0C;&#x8FD9;&#x6837;&#x5C31;&#x4F1A;&#x5360;&#x7528;&#x5927;&#x91CF;&#x7684;&#x5185;&#x5B58;&#xFF0C;&#x6709;&#x65F6;&#x6211;&#x4EEC;&#x53EA;&#x662F;&#x60F3;&#x8BFB;&#x53D6;&#x67D0;&#x4E2A;xml&#x6587;&#x4EF6;&#x4E2D;&#x4E00;&#x4E2A;key&#x7684;value&#xFF0C;&#x7ED3;&#x679C;&#x5B83;&#x628A;&#x6574;&#x4E2A;&#x6587;&#x4EF6;&#x90FD;&#x52A0;&#x8F7D;&#x8FDB;&#x6765;&#x4E86;&#xFF0C;&#x663E;&#x7136;&#x5982;&#x679C;&#x5FC5;&#x8981;&#x7684;&#x8BDD;&#x8FD9;&#x91CC;&#x9700;&#x8981;&#x8FDB;&#x884C;&#x76F8;&#x5173;&#x4F18;&#x5316;&#x5904;&#x7406;&#x3002;</p>
<h4 id="SharedPreferences&#x7684;Editor"><a href="#SharedPreferences&#x7684;Editor" class="headerlink" title="SharedPreferences&#x7684;Editor"></a>SharedPreferences&#x7684;Editor</h4><p>getXXX()&#x65B9;&#x6CD5;&#x4F7F;&#x7528;synchronized&#x5173;&#x952E;&#x5B57;&#xFF0C;this&#x6307;&#x4EE3;SharedPreferencesImpl.class&#x3002;&#x90A3;&#x4E48;&#x770B;&#x770B;SharedPreferences&#x7684;&#x5199;&#x64CD;&#x4F5C;&#x3002;</p>
<p><img src="/2016/11/11/AndroidSharedPreferences/sharedpreferences_10.png" alt=""><br><img src="/2016/11/11/AndroidSharedPreferences/sharedpreferences_11.png" alt=""></p>
<p>&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x4E4B;&#x524D;loadFromDiskLocked()&#x65B9;&#x6CD5;&#x5C06;SharedPreferences&#x6587;&#x4EF6;&#x8BFB;&#x53D6;&#x5230;&#x5185;&#x5B58;&#x4E2D;&#xFF0C;&#x5B58;&#x50A8;&#x5230;mMap&#x4E2D;&#x3002;&#x5E76;&#x4E14;getXXX()&#x65B9;&#x6CD5;&#x4E5F;&#x662F;&#x4ECE;mMap&#x4E2D;&#x53D6;&#x503C;&#x3002;</p>
<p>&#x8FD9;&#x91CC;&#x6BCF;&#x6B21;&#x4FEE;&#x6539;&#x503C;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x90FD;&#x662F;&#x5C06;&#x8981;&#x4FEE;&#x6539;&#x7684;&#x952E;&#x503C;&#x5BF9;&#x5B58;&#x653E;&#x5728;mModified&#x4E2D;&#xFF0C;&#x6700;&#x540E;&#x8C03;&#x7528;apply()&#x6216;&#x8005;commit()&#x624D;&#x4F1A;&#x771F;&#x6B63;&#x628A;&#x6570;&#x636E;&#x5199;&#x5165;&#x6587;&#x4EF6;&#x4E2D;&#x3002;&#x770B;&#x5230;&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x4F1A;&#x8BF4;&#xFF0C;&#x8FD9;&#x91CC;synchronized&#x5173;&#x952E;&#x5B57;this&#x6307;&#x4EE3;<br>EditorImpl.class&#xFF0C;&#x5E76;&#x4E0D;&#x662F;SharedPreferencesImpl.class&#xFF0C;&#x662F;&#x5982;&#x4F55;&#x4FDD;&#x8BC1;&#x7EBF;&#x7A0B;&#x5B89;&#x5168;&#x7684;&#x3002;&#x5F88;&#x660E;&#x663E;&#x6211;&#x4EEC;&#x77E5;&#x9053;&#x4E24;&#x4E2A;&#x65B9;&#x6CD5;&#x4FEE;&#x6539;&#x7684;Map&#x5E76;&#x4E0D;&#x76F8;&#x540C;&#xFF0C;&#x771F;&#x6B63;&#x7684;&#x5199;&#x64CD;&#x4F5C;&#x5E76;&#x4E0D;&#x5728;&#x6B64;&#x3002;</p>
<h4 id="EditorImpl&#x7684;apply-&#x51FD;&#x6570;&#x548C;commit-&#x51FD;&#x6570;&#x7684;&#x6BD4;&#x8F83;"><a href="#EditorImpl&#x7684;apply-&#x51FD;&#x6570;&#x548C;commit-&#x51FD;&#x6570;&#x7684;&#x6BD4;&#x8F83;" class="headerlink" title="EditorImpl&#x7684;apply()&#x51FD;&#x6570;&#x548C;commit()&#x51FD;&#x6570;&#x7684;&#x6BD4;&#x8F83;"></a>EditorImpl&#x7684;apply()&#x51FD;&#x6570;&#x548C;commit()&#x51FD;&#x6570;&#x7684;&#x6BD4;&#x8F83;</h4><p>&#x5148;&#x770B;&#x6587;&#x6863;&#x4ECB;&#x7ECD;&#xFF1A;</p>
<p><img src="/2016/11/11/AndroidSharedPreferences/sharedpreferences_12.png" alt=""></p>
<p>&#x6CE8;&#x610F;&#x5F53;&#x4E24;&#x4E2A;&#x7F16;&#x8BD1;&#x5668;&#x5728;&#x540C;&#x65F6;&#x4FEE;&#x6539;&#x53C2;&#x6570;&#x65F6;&#xFF0C;&#x6700;&#x7EC8;&#x4EE5;&#x540E;&#x9762;&#x7684;apply()&#x6267;&#x884C;&#x6210;&#x529F;&#x3002;</p>
<font color="Red">apply()&#x4F1A;&#x7ACB;&#x523B;&#x63D0;&#x4EA4;&#x6539;&#x53D8;&#x5230;&#x5185;&#x5B58;SharedPreferences&#xFF0C;&#x4F46;&#x662F;&#x4F1A;&#x5F00;&#x542F;&#x4E00;&#x4E2A;&#x5F02;&#x6B65;&#x63D0;&#x4EA4;&#x5230;&#x786C;&#x76D8;&#xFF0C;&#x4E0D;&#x50CF;commit()&#xFF0C;&#x5B83;&#x7684;&#x53C2;&#x6570;&#x662F;&#x540C;&#x6B65;&#x5199;&#x5165;&#x56FA;&#x6001;&#x5B58;&#x50A8;&#x7A7A;&#x95F4;</font>&#xFF0C;&#x4F60;&#x5C06;&#x4E0D;&#x4F1A;&#x88AB;&#x901A;&#x77E5;&#x4EFB;&#x4F55;&#x5931;&#x8D25;&#x4FE1;&#x606F;&#x3002;&#x5982;&#x679C;&#x5176;&#x4ED6;&#x7F16;&#x8F91;&#x5668;&#x5728;apply()&#x65B9;&#x6CD5;&#x8FD8;&#x6CA1;&#x5B8C;&#x6210;&#xFF0C;&#x53C8;&#x518D;SharedPreferences&#x6267;&#x884C;&#x4E00;&#x4E2A;&#x5E38;&#x89C4;&#x7684;commit()&#x65B9;&#x6CD5;&#xFF0C;commit()&#x65B9;&#x6CD5;&#x4F1A;&#x963B;&#x585E;&#x76F4;&#x5230;&#x6240;&#x6709;&#x5F02;&#x6B65;&#x63D0;&#x4EA4;&#x5B8C;&#x6210;&#x3002;<br><br>&#x4F5C;&#x4E3A;&#x5728;&#x8FDB;&#x7A0B;&#x4E2D;&#x7684;&#x4E00;&#x4E2A;&#x5355;&#x4F8B;&#x5BF9;&#x8C61;SharedPreferences&#xFF0C;&#x5982;&#x679C;&#x4F60;&#x5FFD;&#x7565;&#x8FD4;&#x56DE;&#x503C;&#x53EF;&#x4EE5;&#x7528;apply()&#x65B9;&#x6CD5;&#x4EE3;&#x66FF;commit()&#x65B9;&#x6CD5;&#xFF0C;&#x5E76;&#x4E14;&#x662F;&#x5B89;&#x5168;&#x7684;&#x3002;<br><br>&#x4F60;&#x4E0D;&#x9700;&#x8981;&#x62C5;&#x5FC3;&#x7528;apply()&#x5199;&#x5165;&#x78C1;&#x76D8;&#x4F1A;&#x88AB;android&#x7EC4;&#x4EF6;&#x751F;&#x547D;&#x5468;&#x671F;&#x548C;&#x5B83;&#x4EEC;&#x4E4B;&#x95F4;&#x7684;&#x4EA4;&#x4E92;&#x5F71;&#x54CD;&#x3002;framwork&#x4F1A;&#x786E;&#x4FDD;&#x5728;&#x5207;&#x6362;&#x72B6;&#x6001;&#x4E4B;&#x524D;apply()&#x53EF;&#x4EE5;&#x5B8C;&#x6210;&#x5BF9;&#x52A8;&#x6001;&#x78C1;&#x76D8;&#x7684;&#x5199;&#x5165;&#x64CD;&#x4F5C;&#x3002;<br><br><img src="/2016/11/11/AndroidSharedPreferences/sharedpreferences_13.png" alt=""><br><br>&#x6CE8;&#x610F;&#x5F53;&#x4E24;&#x4E2A;&#x7F16;&#x8BD1;&#x5668;&#x5728;&#x540C;&#x65F6;&#x4FEE;&#x6539;&#x53C2;&#x6570;&#x65F6;&#xFF0C;&#x6700;&#x7EC8;&#x4EE5;&#x540E;&#x9762;&#x7684;commit()&#x6267;&#x884C;&#x6210;&#x529F;&#x3002;<br><br><font color="Red">&#x5982;&#x679C;&#x4F60;&#x4E0D;&#x5173;&#x5FC3;&#x8FD4;&#x56DE;&#x503C;&#x5E76;&#x4E14;&#x4F60;&#x7528;&#x5728;&#x4F60;app&#x7684;&#x4E3B;&#x7EBF;&#x7A0B;&#x4E0A;&#x8C03;&#x7528;&#xFF0C;&#x8BD5;&#x7740;&#x7528;apply()&#x4EE3;&#x66FF;commit()&#x3002;</font>

<h5 id="commitToMemory-&#x65B9;&#x6CD5;-&#x548C;-enqueueDiskWrite-&#x65B9;&#x6CD5;"><a href="#commitToMemory-&#x65B9;&#x6CD5;-&#x548C;-enqueueDiskWrite-&#x65B9;&#x6CD5;" class="headerlink" title="commitToMemory()&#x65B9;&#x6CD5; &#x548C; enqueueDiskWrite()&#x65B9;&#x6CD5;"></a>commitToMemory()&#x65B9;&#x6CD5; &#x548C; enqueueDiskWrite()&#x65B9;&#x6CD5;</h5><p><img src="/2016/11/11/AndroidSharedPreferences/sharedpreferences_14.png" alt=""></p>
<p>&#x5173;&#x952E;&#x6709;&#x4E24;&#x6B65;&#xFF0C;&#x5148;&#x8C03;&#x7528;commitToMemory()&#xFF0C;&#x518D;&#x8C03;&#x7528;enqueueDiskWrite()&#xFF0C;commitToMemory()&#x5C31;&#x662F;&#x4EA7;&#x751F;&#x4E00;&#x4E2A;&#x201C;&#x5408;&#x9002;&#x201D;&#x7684;MemoryCommitResult&#x5BF9;&#x8C61;mcr&#xFF0C;&#x7136;&#x540E;&#x8C03;&#x7528;enqueueDiskWrite()&#x65F6;&#x9700;&#x8981;&#x628A;&#x8FD9;&#x4E2A;&#x5BF9;&#x8C61;&#x4F20;&#x8FDB;&#x53BB;&#xFF0C;commitToMemory&#x65B9;&#x6CD5;&#xFF1A;</p>
<p><img src="/2016/11/11/AndroidSharedPreferences/sharedpreferences_15.png" alt=""></p>
<font color="Red">&#x5728;&#x4E00;&#x6B21;commit&#x4E8B;&#x52A1;&#x4E2D;&#xFF0C;&#x5982;&#x679C;&#x540C;&#x65F6;put&#x4E00;&#x4E9B;&#x952E;&#x503C;&#x5BF9;&#x548C;&#x8C03;&#x7528;clear&#xFF0C;&#x90A3;&#x4E48;clear&#x6389;&#x7684;&#x53EA;&#x662F;&#x4E4B;&#x524D;&#x7684;&#x952E;&#x503C;&#x5BF9;&#xFF0C;&#x8FD9;&#x6B21;put&#x8FDB;&#x53BB;&#x7684;&#x952E;&#x503C;&#x5BF9;&#x8FD8;&#x662F;&#x4F1A;&#x88AB;&#x5199;&#x5165;&#x7684;&#x3002;<br><br>&#x5982;&#x679C;&#x4E00;&#x4E2A;&#x952E;&#x503C;&#x5BF9;&#x7684;value&#x662F;this&#xFF08;SharedPreferencesImpl&#xFF09;&#x6216;&#x8005;&#x662F;null&#x90A3;&#x4E48;&#x8868;&#x793A;&#x5C06;&#x6B64;&#x952E;&#x503C;&#x5BF9;&#x5220;&#x9664;&#x3002;</font>

<p>&#x53EF;&#x4EE5;&#x67E5;&#x770B;remove()&#x548C;clear()&#x65B9;&#x6CD5;&#xFF1A;<br><img src="/2016/11/11/AndroidSharedPreferences/sharedpreferences_16.png" alt=""></p>
<p>&#x63A5;&#x4E0B;&#x6765;&#x770B;enqueueDiskWrite()&#x65B9;&#x6CD5;&#xFF1A;</p>
<p><img src="/2016/11/11/AndroidSharedPreferences/sharedpreferences_17.png" alt=""></p>
<font color="Red">&#x4ECE;&#x4EE3;&#x7801;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF0C;commit&#x7684;&#x5199;&#x64CD;&#x4F5C;&#x662F;&#x5728;&#x8C03;&#x7528;&#x7EBF;&#x7A0B;&#x4E2D;&#x6267;&#x884C;&#x7684;&#xFF0C;&#x800C;apply&#x5185;&#x90E8;&#x662F;&#x7528;&#x4E00;&#x4E2A;&#x5355;&#x7EBF;&#x7A0B;&#x7684;&#x7EBF;&#x7A0B;&#x6C60;&#x5B9E;&#x73B0;&#x7684;&#xFF0C;&#x56E0;&#x6B64;&#x5199;&#x64CD;&#x4F5C;&#x662F;&#x5728;&#x5B50;&#x7EBF;&#x7A0B;&#x4E2D;&#x6267;&#x884C;&#x7684;&#x3002;</font>

<h4 id="SharedPreferences&#x6BCF;&#x6B21;&#x5199;&#x5165;&#x65F6;&#x662F;&#x589E;&#x91CF;&#x5199;&#x5165;&#x5417;&#xFF1F;"><a href="#SharedPreferences&#x6BCF;&#x6B21;&#x5199;&#x5165;&#x65F6;&#x662F;&#x589E;&#x91CF;&#x5199;&#x5165;&#x5417;&#xFF1F;" class="headerlink" title="SharedPreferences&#x6BCF;&#x6B21;&#x5199;&#x5165;&#x65F6;&#x662F;&#x589E;&#x91CF;&#x5199;&#x5165;&#x5417;&#xFF1F;"></a>SharedPreferences&#x6BCF;&#x6B21;&#x5199;&#x5165;&#x65F6;&#x662F;&#x589E;&#x91CF;&#x5199;&#x5165;&#x5417;&#xFF1F;</h4><p>mBackupFile&#x5728;SharedPreferencesImpl&#x6784;&#x9020;&#x65B9;&#x6CD5;&#x4E2D;&#x521B;&#x5EFA;&#xFF0C;SharedPreferences&#x5728;&#x5199;&#x5165;&#x65F6;&#x4F1A;&#x5148;&#x628A;&#x4E4B;&#x524D;&#x7684;xml&#x6587;&#x4EF6;&#x6539;&#x6210;&#x540D;&#x6210;&#x4E00;&#x4E2A;&#x5907;&#x4EFD;&#x6587;&#x4EF6;&#xFF0C;&#x7136;&#x540E;&#x518D;&#x5C06;&#x8981;&#x5199;&#x5165;&#x7684;&#x6570;&#x636E;&#x5199;&#x5230;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x6587;&#x4EF6;&#x4E2D;&#xFF0C;&#x5982;&#x679C;&#x8FD9;&#x4E2A;&#x8FC7;&#x7A0B;&#x6267;&#x884C;&#x6210;&#x529F;&#x7684;&#x8BDD;&#xFF0C;&#x5C31;&#x4F1A;&#x628A;&#x5907;&#x4EFD;&#x6587;&#x4EF6;&#x5220;&#x9664;&#x3002;<font color="Red">&#x7531;&#x6B64;&#x53EF;&#x89C1;&#x6BCF;&#x6B21;&#x5373;&#x4F7F;&#x53EA;&#x662F;&#x6DFB;&#x52A0;&#x4E00;&#x4E2A;&#x952E;&#x503C;&#x5BF9;&#xFF0C;&#x4E5F;&#x4F1A;&#x91CD;&#x65B0;&#x5199;&#x5165;&#x6574;&#x4E2A;&#x6587;&#x4EF6;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x8FD9;&#x4E5F;&#x8BF4;&#x660E;SharedPreferences&#x53EA;&#x9002;&#x5408;&#x4FDD;&#x5B58;&#x5C11;&#x91CF;&#x6570;&#x636E;&#xFF0C;&#x6587;&#x4EF6;&#x592A;&#x5927;&#x4F1A;&#x6709;&#x6027;&#x80FD;&#x95EE;&#x9898;&#x3002;</font></p>
<p>&#x6240;&#x4EE5;</p>
<font color="Red">&#x5728;SharedPreferences&#x83B7;&#x53D6;&#x6570;&#x636E;&#x4E0A;&#xFF0C;&#x56E0;apply()&#x548C;commit()&#x63D0;&#x4EA4;&#x90FD;&#x4F1A;&#x5148;&#x5C06;&#x6539;&#x53D8;&#x63D0;&#x4EA4;&#x5230;&#x5185;&#x5B58;&#xFF0C;&#x6240;&#x4EE5;&#x4E0D;&#x7528;&#x62C5;&#x5FC3;&#x7ACB;&#x523B;&#x53D6;&#x503C;&#x4E0D;&#x6B63;&#x786E;&#x7684;&#x95EE;&#x9898;&#x3002;</font>

<h4 id="SharedPreferences&#x662F;&#x5426;&#x8FDB;&#x7A0B;&#x5B89;&#x5168;&#xFF1F;"><a href="#SharedPreferences&#x662F;&#x5426;&#x8FDB;&#x7A0B;&#x5B89;&#x5168;&#xFF1F;" class="headerlink" title="SharedPreferences&#x662F;&#x5426;&#x8FDB;&#x7A0B;&#x5B89;&#x5168;&#xFF1F;"></a>SharedPreferences&#x662F;&#x5426;&#x8FDB;&#x7A0B;&#x5B89;&#x5168;&#xFF1F;</h4><p>&#x5728;<a href="https://developer.android.com/reference/android/content/Context.html#MODE_MULTI_PROCESS/" target="_blank" rel="external">Context&#x7684;&#x6587;&#x6863;</a>&#x4ECB;&#x7ECD;&#x4E2D;&#x6709;&#x4EE5;&#x4E0B;&#x4E00;&#x6BB5;&#x8BDD;&#xFF1A;</p>
<p><img src="/2016/11/11/AndroidSharedPreferences/sharedpreferences_18.png" alt=""></p>
<p>MODE_MULTI_PROCESS&#x4E0D;&#x63D0;&#x4F9B;&#x4EFB;&#x4F55;&#x673A;&#x5236;&#x6765;&#x534F;&#x8C03;&#x8DE8;&#x8FDB;&#x7A0B;&#x5E76;&#x53D1;&#x4FEE;&#x6539;&#x3002;&#x4F5C;&#x4E3A;&#x5F00;&#x53D1;&#x8005;&#x4E0D;&#x5E94;&#x8BE5;&#x8BD5;&#x56FE;&#x4F7F;&#x7528;&#x5B83;&#xFF0C;&#x800C;&#x662F;&#x5E94;&#x8BE5;&#x4F7F;&#x7528;&#x4E00;&#x4E2A;&#x663E;&#x5F0F;&#x7684;&#x8DE8;&#x8FDB;&#x7A0B;&#x6570;&#x636E;&#x7BA1;&#x7406;&#x65B9;&#x6CD5;&#x5982;ContentProvider&#x3002;&#x6240;&#x4EE5;SharedPreferences&#x4E0D;&#x662F;&#x8FDB;&#x7A0B;&#x5B89;&#x5168;&#x7684;&#x3002;</p>
<h3 id="&#x53C2;&#x8003;"><a href="#&#x53C2;&#x8003;" class="headerlink" title="&#x53C2;&#x8003;"></a>&#x53C2;&#x8003;</h3><ol>
<li><p><a href="http://blog.csdn.net/u012619640/article/details/50940074" target="_blank" rel="external">&#x6DF1;&#x5165;&#x7406;&#x89E3;Android&#x4E2D;&#x7684;SharedPreferences</a></p>
</li>
<li><p><a href="http://blog.csdn.net/qinjuning/article/details/7310620" target="_blank" rel="external">Android&#x4E2D;Context&#x8BE6;&#x89E3;</a></p>
</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/11/11/AndroidSharedPreferences/" data-id="cknuhhfjn0028dwqysdr8lrfq" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2016/11/12/AndroidImageLoader/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Android图片加载
        
      </div>
    </a>
  
  
    <a href="/2016/11/11/JavaThreadPoolExecutor/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Java线程池ThreadPoolExecutor源码分析</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/ASM/">ASM</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Android/">Android</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Dart/">Dart</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Flutter/">Flutter</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Network/">Network</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/AIDL/">AIDL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Binder/">Binder</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Bitmap/">Bitmap</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Canvas/">Canvas</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ClassLoader/">ClassLoader</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTTP/">HTTP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/IPC/">IPC</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/IntentFlag/">IntentFlag</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JVM/">JVM</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java并发/">Java并发</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/LaunchMode/">LaunchMode</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Network/">Network</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Push/">Push</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ThreadPoolExecutor/">ThreadPoolExecutor</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/View/">View</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/WebView/">WebView</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/事件分发/">事件分发</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/内存泄露/">内存泄露</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/开源库/">开源库</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/消息机制/">消息机制</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/阻塞队列/">阻塞队列</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/AIDL/" style="font-size: 10px;">AIDL</a> <a href="/tags/Binder/" style="font-size: 10px;">Binder</a> <a href="/tags/Bitmap/" style="font-size: 15px;">Bitmap</a> <a href="/tags/Canvas/" style="font-size: 10px;">Canvas</a> <a href="/tags/ClassLoader/" style="font-size: 10px;">ClassLoader</a> <a href="/tags/HTTP/" style="font-size: 12.5px;">HTTP</a> <a href="/tags/IPC/" style="font-size: 12.5px;">IPC</a> <a href="/tags/IntentFlag/" style="font-size: 10px;">IntentFlag</a> <a href="/tags/JVM/" style="font-size: 10px;">JVM</a> <a href="/tags/Java并发/" style="font-size: 12.5px;">Java并发</a> <a href="/tags/LaunchMode/" style="font-size: 10px;">LaunchMode</a> <a href="/tags/Network/" style="font-size: 17.5px;">Network</a> <a href="/tags/Push/" style="font-size: 10px;">Push</a> <a href="/tags/ThreadPoolExecutor/" style="font-size: 10px;">ThreadPoolExecutor</a> <a href="/tags/View/" style="font-size: 15px;">View</a> <a href="/tags/WebView/" style="font-size: 10px;">WebView</a> <a href="/tags/事件分发/" style="font-size: 10px;">事件分发</a> <a href="/tags/内存泄露/" style="font-size: 10px;">内存泄露</a> <a href="/tags/开源库/" style="font-size: 20px;">开源库</a> <a href="/tags/消息机制/" style="font-size: 10px;">消息机制</a> <a href="/tags/阻塞队列/" style="font-size: 10px;">阻塞队列</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/04/">April 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">September 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">October 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">June 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">March 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">July 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">May 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">September 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">August 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">June 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">April 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">January 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">December 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">November 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">August 2016</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/04/19/Activity黑屏分析/">Activity黑屏分析</a>
          </li>
        
          <li>
            <a href="/2021/04/10/深入理解Binder/">深入理解Binder</a>
          </li>
        
          <li>
            <a href="/2020/09/01/dart-async/">Dart的单线程模型&amp;异步操作</a>
          </li>
        
          <li>
            <a href="/2020/09/01/flutter-thread-model/">Flutter线程模型</a>
          </li>
        
          <li>
            <a href="/2020/09/01/flutter-booting/">深入理解Flutter引擎启动</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2021 xiongcen<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>